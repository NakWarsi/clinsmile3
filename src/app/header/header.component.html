<header class="header" *ngIf="!headerLoading && !headerError" [style.background-color]="headerConfig?.backgroundColor" [class.is-editing]="isEditingHeader">
  <div class="main-header">
    <div class="container">
      <!-- Floating Edit Button -->
      <button class="floating-edit-btn" (click)="startEditingHeader()" *ngIf="globalConfig.showEditButtons && !isEditingHeader">
        <span class="edit-icon-floating">✏️</span>
      </button>

      <div class="logo">
        <a routerLink="/">
          <img [src]="headerConfig?.logoImage" [alt]="headerConfig?.logoAlt" class="logo-image">
          <div class="logo-text">
            <!-- Editable Clinic Name -->
            <div class="editable-element" (click)="startInlineEditHeader('clinic-name')">
              <h1 [style.color]="headerConfig?.logoTextColor" [style.font-family]="headerConfig?.clinicNameFontFamily">
                {{ headerConfig?.clinicName }}
              </h1>
              <span class="edit-icon" *ngIf="globalConfig.showEditButtons && !isEditingHeader">✏️</span>
            </div>
            <div *ngIf="isEditingHeader && editingHeaderElement === 'clinic-name'" class="inline-edit-container">
              <input type="text" [(ngModel)]="headerConfig!.clinicName" class="inline-edit-input" 
                     (blur)="stopInlineEditHeader()" (keyup.enter)="stopInlineEditHeader()">
              <div class="inline-controls">
                <select [(ngModel)]="headerConfig!.clinicNameFontFamily" (change)="onHeaderFontChange()">
                  <option value="Arial, sans-serif">Arial</option>
                  <option value="Georgia, serif">Georgia</option>
                  <option value="Times New Roman, serif">Times New Roman</option>
                  <option value="Helvetica, sans-serif">Helvetica</option>
                </select>
                <input type="color" [(ngModel)]="headerConfig!.logoTextColor" (change)="onHeaderColorChange()">
              </div>
            </div>

            <!-- Editable Tagline -->
            <div class="editable-element" (click)="startInlineEditHeader('tagline')">
              <span class="tagline" [style.color]="headerConfig?.taglineColor" [style.font-family]="headerConfig?.taglineFontFamily">
                {{ headerConfig?.tagline }}
              </span>
              <span class="edit-icon" *ngIf="globalConfig.showEditButtons && !isEditingHeader">✏️</span>
            </div>
            <div *ngIf="isEditingHeader && editingHeaderElement === 'tagline'" class="inline-edit-container">
              <input type="text" [(ngModel)]="headerConfig!.tagline" class="inline-edit-input" 
                     (blur)="stopInlineEditHeader()" (keyup.enter)="stopInlineEditHeader()">
              <div class="inline-controls">
                <select [(ngModel)]="headerConfig!.taglineFontFamily" (change)="onHeaderFontChange()">
                  <option value="Arial, sans-serif">Arial</option>
                  <option value="Georgia, serif">Georgia</option>
                  <option value="Times New Roman, serif">Times New Roman</option>
                  <option value="Helvetica, sans-serif">Helvetica</option>
                </select>
                <input type="color" [(ngModel)]="headerConfig!.taglineColor" (change)="onHeaderColorChange()">
              </div>
            </div>
          </div>
        </a>
      </div>
      
      <nav class="nav" [class.nav-open]="isMenuOpen" [style.background-color]="headerConfig?.backgroundColor">
        <ul class="nav-list">
          <li *ngFor="let navItem of headerConfig?.navItems; let i = index">
            <!-- Editable Navigation Item -->
            <div class="editable-element" (click)="startInlineEditHeader('nav-item-' + i)">
              <a [routerLink]="navItem.route" 
                 [routerLinkActive]="'active'" 
                 [routerLinkActiveOptions]="{exact: navItem.exact}" 
                 (click)="closeMenu()"
                 [style.color]="headerConfig?.navLinkColor"
                 [style.font-family]="headerConfig?.navLinkFontFamily">
                {{ navItem.label }}
              </a>
              <span class="edit-icon" *ngIf="globalConfig.showEditButtons && !isEditingHeader">✏️</span>
            </div>
            <div *ngIf="isEditingHeader && editingHeaderElement === 'nav-item-' + i" class="inline-edit-container">
              <input type="text" [(ngModel)]="navItem.label" class="inline-edit-input" 
                     (blur)="stopInlineEditHeader()" (keyup.enter)="stopInlineEditHeader()">
              <input type="text" [(ngModel)]="navItem.route" class="inline-edit-input" 
                     placeholder="Route" (blur)="stopInlineEditHeader()" (keyup.enter)="stopInlineEditHeader()">
              <div class="inline-controls">
                <select [(ngModel)]="headerConfig!.navLinkFontFamily" (change)="onHeaderFontChange()">
                  <option value="Arial, sans-serif">Arial</option>
                  <option value="Georgia, serif">Georgia</option>
                  <option value="Times New Roman, serif">Times New Roman</option>
                  <option value="Helvetica, sans-serif">Helvetica</option>
                </select>
                <input type="color" [(ngModel)]="headerConfig!.navLinkColor" (change)="onHeaderColorChange()">
                <button class="remove-nav-btn" (click)="removeNavItem(i)">Remove</button>
              </div>
            </div>
          </li>

          <!-- Add New Navigation Item Button -->
          <li *ngIf="isEditingHeader" class="add-nav-item">
            <button class="add-nav-btn" (click)="addNavItem()">+ Add Nav Item</button>
          </li>
        </ul>
      </nav>
      
      <div class="mobile-menu-toggle" [class.active]="isMenuOpen" (click)="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <!-- Global Styling Controls -->
    <div class="global-styling-controls" *ngIf="isEditingHeader">
      <div class="styling-row">
        <div class="styling-item">
          <label>Background Color (Header & Mobile Menu):</label>
          <input type="color" [(ngModel)]="headerConfig!.backgroundColor" (change)="onHeaderBackgroundChange()">
        </div>
        <div class="styling-item">
          <label>Nav Link Hover Color:</label>
          <input type="color" [(ngModel)]="headerConfig!.navLinkHoverColor" (change)="onHeaderColorChange()">
        </div>
        <div class="styling-item">
          <label>Nav Link Active Color:</label>
          <input type="color" [(ngModel)]="headerConfig!.navLinkActiveColor" (change)="onHeaderColorChange()">
        </div>
      </div>
    </div>

    <!-- Edit Actions -->
    <div class="edit-actions" *ngIf="isEditingHeader">
      <button class="save-btn" (click)="stopEditingHeader()">Save Changes</button>
      <button class="cancel-btn" (click)="cancelEditingHeader()">Cancel</button>
      <button class="reset-btn" (click)="resetHeaderToOriginal()">Reset to Original</button>
    </div>
  </div>
</header>

<!-- Loading State -->
<div class="loading-container" *ngIf="headerLoading">
  <p>Loading header configuration...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="headerError">
  <p>Error loading header configuration. Please try again.</p>
</div>
